import{t as e,k as a,c as t,R as l,I as s,K as n,V as c,L as u,S as o,J as r,U as d,b as i,h as f,d as _}from"./uni.CnKTWU0K.js";import{o as m,Z as v}from"./index-C3v_m0JD.js";import{d as g,b as p,c as h,R as k,a6 as b,ad as y,a7 as S,M as w,aW as C,aP as j,_ as $,u as F,aY as D,aN as T,az as x,ak as I,aX as R,ai as M}from"./vendor.CqD9dFNX.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=Y(g({__name:"recharge-audit",setup(g){const Y=p(20),B=function(e){const a=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0");return`${a}-${t}-${l}`}(new Date),H=p(B),z=p([]),A=p(!0),J=p(!1),K=p({}),L=h((()=>z.value.filter((e=>"pending"===e.status)).length)),N=h((()=>z.value.reduce(((e,a)=>e+a.amount),0)));k((()=>{P();const a=e();Y.value=a.statusBarHeight||20,U()})),m((()=>{P()}));const P=async()=>{try{const e=a("token");if(!e)return t({title:"请先登录",icon:"none"}),void setTimeout((()=>{l()}),1500);const{result:s}=await v.callFunction({name:"user",data:{action:"checkAdminStatus",token:e}});s&&0===s.code&&s.is_admin||(t({title:"无管理员权限",icon:"none"}),setTimeout((()=>{l()}),1500))}catch(e){console.error("检查管理员权限失败:",e),t({title:"权限检查失败",icon:"none"}),setTimeout((()=>{l()}),1500)}},U=async()=>{A.value=!0;try{const e=a("token");if(!e)return t({title:"请先登录",icon:"none"}),void setTimeout((()=>{l()}),1500);console.log("获取充值记录，token:",e,"日期:",H.value);const{result:s}=await v.callFunction({name:"recharge",data:{action:"getRechargeRecordsByDate",token:e,data:{date:H.value}}});console.log("获取充值记录结果:",s),s&&0===s.code?z.value=s.data.sort(((e,a)=>"pending"===e.status&&"pending"!==a.status?-1:"pending"!==e.status&&"pending"===a.status?1:new Date(a.create_time).getTime()-new Date(e.create_time).getTime())):t({title:(null==s?void 0:s.msg)||"获取数据失败",icon:"none"})}catch(e){console.error("获取充值记录失败:",e),t({title:"获取数据失败",icon:"none"})}finally{A.value=!1}},V=e=>{H.value=e.detail.value,U()},W=()=>{J.value=!1},X=()=>{l()};function Z(e){return e.toFixed(2)}function q(e){if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`}function E(e){if(!e)return"未知";switch(e){case"wechat":return"微信支付";case"alipay":return"支付宝";default:return e}}function G(e){if(!e)return"";switch(e){case"pending":return"status-pending";case"approved":return"status-approved";case"rejected":return"status-rejected";default:return""}}function O(e){if(!e)return"未知";switch(e){case"pending":return"待审核";case"approved":return"已通过";case"rejected":return"已拒绝";default:return"未知"}}return(e,l)=>{const m=s,g=n,p=c,h=u,k=o,P=r;return S(),b(m,{class:"recharge-audit"},{default:y((()=>[w(m,{class:"page-background"}),w(m,{class:"back-btn",style:j({top:Y.value+6+"px"}),onClick:X},{default:y((()=>[w(m,{class:"back-arrow"})])),_:1},8,["style"]),w(m,{class:"content-wrapper",style:j({paddingTop:Y.value+44+"px"})},{default:y((()=>[w(m,{class:"header"},{default:y((()=>[w(g,{class:"title"},{default:y((()=>[$("充值审核管理")])),_:1})])),_:1}),w(m,{class:"date-picker"},{default:y((()=>[w(p,{mode:"date",value:H.value,end:F(B),onChange:V},{default:y((()=>[w(m,{class:"picker-content"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("查询日期：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(H.value),1)])),_:1}),w(g,{class:"icon"},{default:y((()=>[$("▼")])),_:1})])),_:1})])),_:1},8,["value","end"]),w(h,{class:"refresh-btn",onClick:U},{default:y((()=>[$("刷新数据")])),_:1})])),_:1}),w(m,{class:"records-container"},{default:y((()=>[w(m,{class:"records-header"},{default:y((()=>[w(g,{class:"header-item order-number"},{default:y((()=>[$("订单号")])),_:1}),w(g,{class:"header-item nickname"},{default:y((()=>[$("用户名")])),_:1}),w(g,{class:"header-item mobile"},{default:y((()=>[$("手机号")])),_:1}),w(g,{class:"header-item amount"},{default:y((()=>[$("金额")])),_:1}),w(g,{class:"header-item status"},{default:y((()=>[$("状态")])),_:1})])),_:1}),w(k,{"scroll-y":"true",class:"records-list"},{default:y((()=>[A.value?(S(),b(m,{key:0,class:"loading"},{default:y((()=>[$("加载中...")])),_:1})):0===z.value.length?(S(),b(m,{key:1,class:"no-data"},{default:y((()=>[$("没有充值记录")])),_:1})):(S(!0),T(x,{key:2},I(z.value,((e,a)=>(S(),b(m,{class:"record-item",key:e._id,onClick:a=>(e=>{K.value=e,J.value=!0})(e)},{default:y((()=>[w(g,{class:"item-cell order-number"},{default:y((()=>[$(D(e.order_number),1)])),_:2},1024),w(g,{class:"item-cell nickname"},{default:y((()=>{var a;return[$(D((null==(a=e.user_info)?void 0:a.nickname)||"未知"),1)]})),_:2},1024),w(g,{class:"item-cell mobile"},{default:y((()=>{var a,t;return[$(D((t=null==(a=e.user_info)?void 0:a.mobile,t?t.substring(0,3)+"****"+t.substring(7):"未知")),1)]})),_:2},1024),w(g,{class:"item-cell amount"},{default:y((()=>[$("¥"+D(Z(e.amount)),1)])),_:2},1024),w(g,{class:R(["item-cell status",G(e.status)])},{default:y((()=>[$(D(O(e.status)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),w(m,{class:"footer-stats"},{default:y((()=>[w(m,{class:"stat-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("总记录：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(z.value.length),1)])),_:1})])),_:1}),w(m,{class:"stat-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("待审核：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(L.value),1)])),_:1})])),_:1}),w(m,{class:"stat-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("总金额：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$("¥"+D(Z(N.value)),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),J.value?(S(),b(m,{key:0,class:"detail-modal",onClick:M(W,["self"])},{default:y((()=>[w(m,{class:"modal-content"},{default:y((()=>[w(m,{class:"modal-header"},{default:y((()=>[w(g,{class:"modal-title"},{default:y((()=>[$("充值详情")])),_:1}),w(g,{class:"close-btn",onClick:W},{default:y((()=>[$("×")])),_:1})])),_:1}),w(m,{class:"modal-body"},{default:y((()=>[w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("订单号：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(K.value.order_number),1)])),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("用户昵称：")])),_:1}),w(g,{class:"value"},{default:y((()=>{var e;return[$(D((null==(e=K.value.user_info)?void 0:e.nickname)||"未知用户"),1)]})),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("手机号：")])),_:1}),w(g,{class:"value"},{default:y((()=>{var e;return[$(D((null==(e=K.value.user_info)?void 0:e.mobile)||"未知"),1)]})),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("充值金额：")])),_:1}),w(g,{class:"value highlight"},{default:y((()=>[$("¥"+D(Z(K.value.amount)),1)])),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("支付方式：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(E(K.value.payment_method)),1)])),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("申请时间：")])),_:1}),w(g,{class:"value"},{default:y((()=>[$(D(q(K.value.create_time)),1)])),_:1})])),_:1}),w(m,{class:"detail-item"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("状态：")])),_:1}),w(g,{class:R(["value",G(K.value.status)])},{default:y((()=>[$(D(O(K.value.status)),1)])),_:1},8,["class"])])),_:1}),w(m,{class:"detail-item screenshot"},{default:y((()=>[w(g,{class:"label"},{default:y((()=>[$("支付凭证：")])),_:1}),K.value.screenshot?(S(),b(P,{key:0,class:"screenshot-image",src:K.value.screenshot,mode:"aspectFit",onClick:l[0]||(l[0]=e=>{return a=K.value.screenshot,void d({urls:[a],current:a});var a})},null,8,["src"])):(S(),b(g,{key:1,class:"no-image"},{default:y((()=>[$("未上传凭证")])),_:1}))])),_:1})])),_:1}),"pending"===K.value.status?(S(),b(m,{key:0,class:"modal-footer"},{default:y((()=>[w(h,{class:"btn reject",onClick:l[1]||(l[1]=e=>(async e=>{try{_({title:"确认拒绝",content:"您确定要拒绝这笔充值申请吗？",success:async l=>{if(l.confirm){i({title:"处理中..."});const l=a("token");if(!l)return t({title:"请先登录",icon:"none"}),void f();console.log("拒绝充值申请，recordId:",e,"token:",l);const{result:s}=await v.callFunction({name:"recharge",data:{action:"rejectRecharge",token:l,data:{recordId:e}}});f(),console.log("拒绝申请结果:",s),s&&0===s.code?(t({title:"已拒绝申请",icon:"success"}),W(),U()):t({title:(null==s?void 0:s.msg)||"操作失败",icon:"none"})}}})}catch(l){console.error("拒绝申请失败:",l),t({title:"操作失败",icon:"none"}),f()}})(K.value._id))},{default:y((()=>[$("拒绝申请")])),_:1}),w(h,{class:"btn approve",onClick:l[2]||(l[2]=e=>(async e=>{try{i({title:"处理中..."});const l=a("token");if(!l)return void t({title:"请先登录",icon:"none"});console.log("审核通过充值，recordId:",e,"token:",l);const{result:s}=await v.callFunction({name:"recharge",data:{action:"approveRecharge",token:l,data:{recordId:e}}});console.log("审核通过结果:",s),s&&0===s.code?(t({title:"审核通过",icon:"success"}),W(),U()):t({title:(null==s?void 0:s.msg)||"操作失败",icon:"none"})}catch(l){console.error("审核失败:",l),t({title:"操作失败",icon:"none"})}finally{f()}})(K.value._id))},{default:y((()=>[$("通过申请")])),_:1})])),_:1})):C("",!0)])),_:1})])),_:1})):C("",!0)])),_:1})}}}),[["__scopeId","data-v-a1f97dc8"]]);export{B as default};
