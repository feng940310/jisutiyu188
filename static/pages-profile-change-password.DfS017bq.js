import{p as s,I as a,K as e,M as o,L as l,R as r,b as t,k as d,h as n,c,r as u,E as i}from"./uni.CnKTWU0K.js";import{Z as w}from"./index-C3v_m0JD.js";import{d as f,b as m,r as p,a6 as P,ad as _,a7 as v,M as g,aP as k,_ as y,aW as b,aY as h}from"./vendor.CqD9dFNX.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=x(f({__name:"change-password",setup(f){const x=m(0),V=p({oldPassword:"",newPassword:"",confirmPassword:""}),C=p({oldPassword:"",newPassword:"",confirmPassword:""}),j=m(!1),I=m(!1),U=m(!1);s({success:s=>{x.value=s.statusBarHeight||0}});const E=()=>{r()},F=()=>{j.value=!j.value},M=()=>{I.value=!I.value},Z=()=>{U.value=!U.value},$=async()=>{var s;if((()=>{let s=!0;return V.oldPassword?C.oldPassword="":(C.oldPassword="请输入当前密码",s=!1),V.newPassword?/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).{6,12}$/.test(V.newPassword)?C.newPassword="":(C.newPassword="密码必须为6-12位，包含字母、数字和特殊符号",s=!1):(C.newPassword="请输入新密码",s=!1),V.confirmPassword?V.confirmPassword!==V.newPassword?(C.confirmPassword="两次输入的密码不一致",s=!1):C.confirmPassword="":(C.confirmPassword="请确认新密码",s=!1),s})()){t({title:"提交中..."});try{const e=d("token"),o=await w.callFunction({name:"user",data:{action:"changePassword",token:e,data:{oldPassword:V.oldPassword,newPassword:V.newPassword}}});if(n(),o.result&&0===o.result.code){c({title:"密码修改成功，请重新登录",icon:"success"});try{await w.callFunction({name:"user",data:{action:"logout"}})}catch(a){console.error("调用登出接口失败",a)}u("token"),u("tokenExpire"),u("userInfo"),u("userId"),setTimeout((()=>{i({url:"/pages/profile/index"})}),1500)}else c({title:(null==(s=o.result)?void 0:s.msg)||"修改失败",icon:"none"})}catch(e){n(),console.error("修改密码失败",e),c({title:"修改失败，请重试",icon:"none"})}}};return(s,r)=>{const t=a,d=e,n=o,c=l;return v(),P(t,{class:"change-password-container"},{default:_((()=>[g(t,{class:"background-layer"}),g(t,{class:"content-layer"},{default:_((()=>[g(t,{class:"status-bar",style:k({height:x.value+"px"})},null,8,["style"]),g(t,{class:"nav-bar"},{default:_((()=>[g(t,{class:"back-btn",onClick:E},{default:_((()=>[g(t,{class:"icon-back"})])),_:1}),g(d,{class:"page-title"},{default:_((()=>[y("修改密码")])),_:1})])),_:1}),g(t,{class:"form-container"},{default:_((()=>[g(t,{class:"form-item"},{default:_((()=>[g(d,{class:"form-label"},{default:_((()=>[y("当前密码")])),_:1}),g(t,{class:"input-container"},{default:_((()=>[g(n,{class:"form-input",type:j.value?"text":"password",modelValue:V.oldPassword,"onUpdate:modelValue":r[0]||(r[0]=s=>V.oldPassword=s),placeholder:"请输入当前密码"},null,8,["type","modelValue"]),g(d,{class:"toggle-password",onClick:F},{default:_((()=>[y(h(j.value?"隐藏":"显示"),1)])),_:1})])),_:1}),C.oldPassword?(v(),P(d,{key:0,class:"error-tip"},{default:_((()=>[y(h(C.oldPassword),1)])),_:1})):b("",!0)])),_:1}),g(t,{class:"form-item"},{default:_((()=>[g(d,{class:"form-label"},{default:_((()=>[y("新密码")])),_:1}),g(t,{class:"input-container"},{default:_((()=>[g(n,{class:"form-input",type:I.value?"text":"password",modelValue:V.newPassword,"onUpdate:modelValue":r[1]||(r[1]=s=>V.newPassword=s),placeholder:"请输入新密码"},null,8,["type","modelValue"]),g(d,{class:"toggle-password",onClick:M},{default:_((()=>[y(h(I.value?"隐藏":"显示"),1)])),_:1})])),_:1}),C.newPassword?(v(),P(d,{key:0,class:"error-tip"},{default:_((()=>[y(h(C.newPassword),1)])),_:1})):b("",!0),g(d,{class:"password-tip"},{default:_((()=>[y("密码必须为6-12位，包含字母、数字和特殊符号")])),_:1})])),_:1}),g(t,{class:"form-item"},{default:_((()=>[g(d,{class:"form-label"},{default:_((()=>[y("确认新密码")])),_:1}),g(t,{class:"input-container"},{default:_((()=>[g(n,{class:"form-input",type:U.value?"text":"password",modelValue:V.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=s=>V.confirmPassword=s),placeholder:"请再次输入新密码"},null,8,["type","modelValue"]),g(d,{class:"toggle-password",onClick:Z},{default:_((()=>[y(h(U.value?"隐藏":"显示"),1)])),_:1})])),_:1}),C.confirmPassword?(v(),P(d,{key:0,class:"error-tip"},{default:_((()=>[y(h(C.confirmPassword),1)])),_:1})):b("",!0)])),_:1}),g(c,{class:"submit-btn",onClick:$},{default:_((()=>[y("确认修改")])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-3c4c8dd3"]]);export{V as default};
