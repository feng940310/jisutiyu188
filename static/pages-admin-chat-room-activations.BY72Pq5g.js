import{t,k as a,c as e,I as o,R as s,E as n,b as l,h as i,K as c,L as r}from"./uni.CnKTWU0K.js";import{o as u,Z as d}from"./index-C3v_m0JD.js";import{a6 as f,ad as m,aP as g,b as h,R as p,a7 as _,M as v,_ as y,aN as k,az as B,ak as x,aY as b}from"./vendor.CqD9dFNX.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=w({setup(){const o=h(20),c=h(0),r=h({width:87,height:32,top:0,bottom:0,right:0}),f=h([]),m=h(!0);p((()=>{g(),_()})),u((()=>{_()}));const g=()=>{try{const a=t();o.value=a.statusBarHeight||20,r.value={width:87,height:32,top:o.value+8,bottom:o.value+8+32,right:10};const e=2*(r.value.top-o.value)+r.value.height;c.value=e}catch(a){console.error("获取系统信息失败:",a)}},_=async()=>{m.value=!0;try{const t=a("token"),{result:o}=await d.callFunction({name:"chatRoom",data:{action:"getActivationsList",token:t}});o&&0===o.code?f.value=o.data||[]:e({title:(null==o?void 0:o.message)||"获取通知列表失败",icon:"none"})}catch(t){console.error("获取激活通知列表失败:",t),e({title:"获取通知列表失败",icon:"none"})}finally{m.value=!1}};return{statusBarHeight:o,navBarHeight:c,menuButtonInfo:r,activations:f,isLoading:m,formatDate:t=>{if(!t)return"";const a=new Date(t);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},confirmNotification:async t=>{l({title:"处理中..."});try{const o=a("token"),{result:s}=await d.callFunction({name:"chatRoom",data:{action:"confirmActivation",id:t,token:o}});s&&0===s.code?(e({title:"已标记为已读",icon:"success"}),f.value=f.value.filter((a=>a._id!==t))):e({title:(null==s?void 0:s.message)||"操作失败",icon:"none"})}catch(o){console.error("确认通知失败:",o),e({title:"确认失败",icon:"none"})}finally{i()}},goBack:()=>{s({delta:1,fail:function(){n({url:"/pages/admin/admin-panel"})}})}}}},[["render",function(t,a,e,s,n,l){const i=o,u=c,d=r;return _(),f(i,{class:"activations-container",style:g({paddingTop:s.statusBarHeight+"px"})},{default:m((()=>[v(i,{class:"page-background"}),v(i,{class:"status-bar",style:g({height:s.statusBarHeight+"px"})},null,8,["style"]),v(i,{class:"nav-bar"},{default:m((()=>[v(i,{class:"nav-left",onClick:s.goBack,style:g({top:s.menuButtonInfo.top+"px",height:s.menuButtonInfo.height+"px"})},{default:m((()=>[v(i,{class:"back-arrow"})])),_:1},8,["onClick","style"]),v(u,{class:"nav-title",style:g({top:s.menuButtonInfo.top+"px",height:s.menuButtonInfo.height+"px",lineHeight:s.menuButtonInfo.height+"px"})},{default:m((()=>[y("聊天室激活通知")])),_:1},8,["style"]),v(i,{class:"nav-right",style:g({width:s.menuButtonInfo.width+"px"})},null,8,["style"])])),_:1}),v(i,{class:"room-list",style:g({paddingTop:s.navBarHeight+"px"})},{default:m((()=>[s.isLoading?(_(),f(i,{key:0,class:"loading"},{default:m((()=>[v(u,null,{default:m((()=>[y("加载中...")])),_:1})])),_:1})):0===s.activations.length?(_(),f(i,{key:1,class:"empty-state"},{default:m((()=>[v(u,null,{default:m((()=>[y("暂无聊天室激活通知")])),_:1})])),_:1})):(_(),f(i,{key:2},{default:m((()=>[(_(!0),k(B,null,x(s.activations,((t,a)=>(_(),f(i,{key:t._id,class:"room-item"},{default:m((()=>[v(i,{class:"room-content"},{default:m((()=>[v(i,{class:"room-header"},{default:m((()=>[v(u,{class:"room-name ellipsis"},{default:m((()=>[y(b(t.room_title||"未命名聊天室"),1)])),_:2},1024),v(u,{class:"room-status status-active"},{default:m((()=>[y("新激活")])),_:1})])),_:2},1024),v(i,{class:"room-subtitle ellipsis"},{default:m((()=>[y("ID: "+b(t.room_id),1)])),_:2},1024),v(i,{class:"room-info-row"},{default:m((()=>[v(u,{class:"room-info"},{default:m((()=>[y("激活时间: "+b(s.formatDate(t.activation_time)),1)])),_:2},1024)])),_:2},1024),v(i,{class:"room-info-row"},{default:m((()=>[v(u,{class:"room-info"},{default:m((()=>[y("激活人: "+b(t.activator_nickname||"未知用户"),1)])),_:2},1024),v(u,{class:"room-info"},{default:m((()=>[y("参与人数: "+b(t.participants_count)+"人",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(i,{class:"activation-action"},{default:m((()=>[v(d,{class:"confirm-btn",onClick:a=>s.confirmNotification(t._id)},{default:m((()=>[y("已读")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1},8,["style"])])),_:1},8,["style"])}],["__scopeId","data-v-d8d4ad64"]]);export{I as default};
