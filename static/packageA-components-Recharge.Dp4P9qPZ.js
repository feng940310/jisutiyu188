import{t as a,I as e,K as l,J as t,L as s,R as o,c,k as n,b as u,h as i,w as d}from"./uni.CnKTWU0K.js";import{b as r,Z as v}from"./index-C3v_m0JD.js";import{d as f,b as m,R as p,n as _,w as h,a6 as g,ad as k,a7 as y,M as b,aW as x,aP as w,_ as C,aY as F,aN as M,az as P,ak as R,aX as j,ai as q}from"./vendor.CqD9dFNX.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=T(f({__name:"Recharge",setup(f){m(0);const T=m(0),I=m(0),N=m(0),D=m(0),H=m(0),Q=m(0),$=m(0),z=m(0),B=m(0),J=[50,100,200,500,1e3],K=m(!1),L=m("wechat"),S=m(""),W=m("");r((a=>{console.log("options",a),a.balance&&(T.value=Number(a.balance)),X()}));const X=()=>{try{const e=a();N.value=e.statusBarHeight||20,console.log("系统信息:",e),console.log("平台:",e.platform),N.value=0,H.value=32,Q.value=87,$.value=20,D.value=44,z.value=6,B.value=6,console.log("H5端导航栏设置完成")}catch(e){console.error("初始化导航栏信息失败:",e),Y()}},Y=()=>{console.log("使用默认导航栏值"),H.value=32,Q.value=87,$.value=20,D.value=N.value+44,z.value=N.value+6,B.value=N.value+6};p((()=>{_((()=>{setTimeout((()=>{0===D.value&&(console.log("导航栏高度为0，重新初始化"),X())}),100)}))}));const Z=()=>{o()},A=a=>Number(a).toFixed(2),E=async()=>{if(!I.value)return void c({title:"请选择充值金额",icon:"none"});const a=n("token");if(a){L.value="wechat",K.value=!0,u({title:"加载中..."});try{const{result:e}=await v.callFunction({name:"payment_config",data:{action:"getPaymentQRCode",token:a,type:"wechat"}});e&&0===e.code&&e.data?W.value=e.data.qrcode:c({title:(null==e?void 0:e.msg)||"获取二维码失败",icon:"none"})}catch(e){console.error("获取支付二维码失败:",e),c({title:"获取二维码失败",icon:"none"})}finally{i()}}else c({title:"请先登录",icon:"none"})},G=()=>{K.value=!1},O=()=>{d({count:1,success:async a=>{const e=a.tempFilePaths[0];try{const a=await v.uploadFile({filePath:e,cloudPath:`recharge-proofs/${Date.now()}-${Math.random().toString(36).slice(-6)}.jpg`});S.value=a.fileID}catch(l){console.error("上传图片失败:",l),c({title:"上传图片失败",icon:"none"})}}})},U=()=>{S.value=""},V=async()=>{if(S.value&&I.value)try{const a=n("token");if(!a)return void c({title:"请先登录",icon:"none"});console.log("提交充值申请，token:",a),u({title:"提交中..."});const{result:e}=await v.callFunction({name:"recharge",data:{action:"submitRecharge",token:a,data:{amount:I.value,payment_method:L.value,screenshot:S.value}}});i(),0===e.code?(c({title:"提交成功",icon:"success"}),G(),I.value=0,S.value="",setTimeout((()=>{o()}),1500)):c({title:e.msg||"提交失败",icon:"none"})}catch(a){i(),console.error("提交充值申请失败:",a),c({title:"提交失败",icon:"none"})}else c({title:"请上传支付凭证",icon:"none"})};return h(L,(async a=>{u({title:"加载中..."});const e=n("token");try{const{result:l}=await v.callFunction({name:"payment_config",data:{action:"getPaymentQRCode",token:e,type:a}});l&&0===l.code&&l.data?W.value=l.data.qrcode:c({title:(null==l?void 0:l.msg)||"获取二维码失败",icon:"none"})}catch(l){console.error("获取支付二维码失败:",l),c({title:"获取二维码失败",icon:"none"})}finally{i()}})),(a,o)=>{const c=e,n=l,u=t,i=s;return y(),g(c,{class:"recharge-page"},{default:k((()=>[b(c,{class:"background-image-cover"}),b(c,{class:"header",style:w({paddingTop:N.value+"px",height:Math.max(D.value,44)+"px"})},{default:k((()=>[b(c,{class:"back-btn",style:w({left:Math.max($.value,20)+"px",top:Math.max(z.value,N.value+6)+"px",height:Math.max(H.value,32)+"px",width:Math.max(Q.value,87)+"px"}),onClick:Z},{default:k((()=>[b(n,{class:"icon-back"}),b(n,null,{default:k((()=>[C("返回")])),_:1})])),_:1},8,["style"])])),_:1},8,["style"]),b(c,{class:"content-wrapper",style:w({paddingTop:Math.max(D.value,64)+"px"})},{default:k((()=>[b(c,{class:"balance-info"},{default:k((()=>[b(n,{class:"current-balance-label"},{default:k((()=>[C("当前余额:")])),_:1}),b(n,{class:"current-balance-value"},{default:k((()=>[C("["+F(A(T.value))+"]",1)])),_:1})])),_:1}),b(c,{class:"recharge-amount"},{default:k((()=>[b(n,{class:"amount"},{default:k((()=>[C(F(I.value||"0"),1)])),_:1})])),_:1}),b(c,{class:"quick-recharge"},{default:k((()=>[b(n,{class:"section-title"},{default:k((()=>[C("快速充值")])),_:1}),b(c,{class:"options"},{default:k((()=>[(y(),M(P,null,R(J,(a=>b(c,{key:a,class:j(["option-item",{active:I.value===a}]),onClick:e=>(a=>{I.value=a})(a)},{default:k((()=>[b(c,{class:"option-background-image"}),C(" "+F(a)+"元 ",1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),b(c,{class:"confirm-recharge",onClick:E},{default:k((()=>[b(c,{class:"confirm-recharge-bg"},{default:k((()=>[C("确认充值")])),_:1})])),_:1})])),_:1},8,["style"]),K.value?(y(),g(c,{key:0,class:"modal-mask",onClick:G},{default:k((()=>[b(c,{class:"modal-content",onClick:o[2]||(o[2]=q((()=>{}),["stop"]))},{default:k((()=>[b(c,{class:"modal-header"},{default:k((()=>[b(n,{class:"modal-title"},{default:k((()=>[C("选择支付方式")])),_:1}),b(n,{class:"close-btn",onClick:G},{default:k((()=>[C("×")])),_:1})])),_:1}),b(c,{class:"payment-tabs"},{default:k((()=>[b(c,{class:j(["tab-item",{active:"wechat"===L.value}]),onClick:o[0]||(o[0]=a=>L.value="wechat")},{default:k((()=>[b(n,null,{default:k((()=>[C("微信支付")])),_:1})])),_:1},8,["class"]),b(c,{class:j(["tab-item",{active:"alipay"===L.value}]),onClick:o[1]||(o[1]=a=>L.value="alipay")},{default:k((()=>[b(n,null,{default:k((()=>[C("支付宝")])),_:1})])),_:1},8,["class"])])),_:1}),b(c,{class:"qrcode-section"},{default:k((()=>[b(u,{class:"qrcode",src:W.value,mode:"aspectFit"},null,8,["src"]),b(n,{class:"amount-text"},{default:k((()=>[C("充值金额："+F(A(I.value))+"元",1)])),_:1})])),_:1}),b(c,{class:"upload-section"},{default:k((()=>[S.value?(y(),g(c,{key:1,class:"preview-box"},{default:k((()=>[b(u,{src:S.value,mode:"aspectFit",class:"preview-image"},null,8,["src"]),b(n,{class:"delete-icon",onClick:U},{default:k((()=>[C("×")])),_:1})])),_:1})):(y(),g(c,{key:0,class:"upload-box",onClick:O},{default:k((()=>[b(n,{class:"upload-icon"},{default:k((()=>[C("+")])),_:1}),b(n,{class:"upload-text"},{default:k((()=>[C("上传支付凭证")])),_:1})])),_:1}))])),_:1}),b(i,{class:"submit-btn",disabled:!S.value||!I.value,onClick:V},{default:k((()=>[C(" 我已上传凭证，请审核 ")])),_:1},8,["disabled"])])),_:1})])),_:1})):x("",!0)])),_:1})}}}),[["__scopeId","data-v-d96d7941"]]);export{I as default};
