import{t as a,k as t,c as e,R as s,b as c,h as l,I as o,K as n,T as i,J as u,L as d,w as r,d as p,U as f}from"./uni.CnKTWU0K.js";import{Z as _}from"./index-C3v_m0JD.js";import{d as m,b as y,R as h,a6 as k,ad as v,a7 as g,M as w,aP as q,_ as C}from"./vendor.CqD9dFNX.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=b(m({__name:"payment-config",setup(m){const b=y({type:"wechat",qrcode:"",status:0}),F=y({type:"alipay",qrcode:"",status:0}),x=y(20);h((async()=>{await R();const t=a();x.value=t.statusBarHeight||20,await j(),await I()}));const R=async()=>{try{const a=t("token");if(!a)return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{s()}),1500);const{result:c}=await _.callFunction({name:"user",data:{action:"checkAdminStatus",token:a}});c&&0===c.code&&c.is_admin||(e({title:"无管理员权限",icon:"none"}),setTimeout((()=>{s()}),1500))}catch(a){console.error("检查管理员权限失败:",a),e({title:"权限检查失败",icon:"none"}),setTimeout((()=>{s()}),1500)}},j=async()=>{try{const{result:a}=await _.callFunction({name:"payment_config",data:{action:"initConfig"}});console.log("初始化支付配置结果:",a)}catch(a){console.error("初始化支付配置失败:",a)}},I=async()=>{try{c({title:"加载中..."});const a=t("token"),{result:s}=await _.callFunction({name:"payment_config",data:{action:"getQRCodeList",token:a}});l(),s&&0===s.code&&s.data?s.data.forEach((a=>{"wechat"===a.type?b.value=a:"alipay"===a.type&&(F.value=a)})):e({title:(null==s?void 0:s.msg)||"获取支付配置失败",icon:"none"})}catch(a){l(),console.error("获取二维码列表失败:",a),e({title:"获取支付配置失败",icon:"none"})}},T=async a=>{r({count:1,sizeType:["original","compressed"],success:async s=>{const o=s.tempFilePaths[0];try{c({title:"上传中..."});const s=await _.uploadFile({filePath:o,cloudPath:`payment-qrcodes/${a}-${Date.now()}.jpg`});console.log("上传结果:",s);const n=t("token"),{result:i}=await _.callFunction({name:"payment_config",data:{action:"updateQRCode",token:n,data:{type:a,qrcodeFileID:s.fileID}}});l(),i&&0===i.code?(e({title:"更新成功",icon:"success"}),await I()):e({title:(null==i?void 0:i.msg)||"更新失败",icon:"none"})}catch(n){l(),console.error("上传二维码失败:",n),e({title:"上传失败",icon:"none"})}}})},D=async a=>{p({title:"确认删除",content:"确定要删除该二维码吗？",success:async s=>{if(s.confirm)try{c({title:"处理中..."});const s=t("token"),{result:o}=await _.callFunction({name:"payment_config",data:{action:"updateQRCode",token:s,data:{type:a,qrcodeFileID:"",status:0}}});l(),o&&0===o.code?(e({title:"删除成功",icon:"success"}),"wechat"===a?(b.value.qrcode="",b.value.status=0):(F.value.qrcode="",F.value.status=0)):e({title:(null==o?void 0:o.msg)||"删除失败",icon:"none"})}catch(o){l(),console.error("删除二维码失败:",o),e({title:"删除失败",icon:"none"})}}})},P=async(a,s)=>{const o=s?1:0;try{c({title:"更新中..."});const s=t("token"),{result:n}=await _.callFunction({name:"payment_config",data:{action:"updateQRCode",token:s,data:{type:a,status:o}}});l(),n&&0===n.code?(e({title:"更新成功",icon:"success"}),"wechat"===a?b.value.status=o:F.value.status=o):(e({title:(null==n?void 0:n.msg)||"更新失败",icon:"none"}),"wechat"===a?b.value.status=1===b.value.status?1:0:F.value.status=1===F.value.status?1:0)}catch(n){l(),console.error("更新状态失败:",n),e({title:"更新失败",icon:"none"})}},Q=a=>{f({urls:[a],current:a})},L=()=>{s()};return(a,t)=>{const e=o,s=n,c=i,l=u,r=d;return g(),k(e,{class:"payment-config"},{default:v((()=>[w(e,{class:"page-background"}),w(e,{class:"back-btn",onClick:L,style:q({top:x.value+6+"px"})},{default:v((()=>[w(e,{class:"back-arrow"})])),_:1},8,["style"]),w(e,{class:"content-wrapper"},{default:v((()=>[w(e,{class:"header"},{default:v((()=>[w(s,{class:"title"},{default:v((()=>[C("支付配置管理")])),_:1})])),_:1}),w(e,{class:"config-container"},{default:v((()=>[w(e,{class:"payment-card"},{default:v((()=>[w(e,{class:"card-header"},{default:v((()=>[w(s,{class:"payment-title"},{default:v((()=>[C("微信支付")])),_:1}),w(c,{checked:1===b.value.status,onChange:t[0]||(t[0]=a=>P("wechat",a.detail.value)),color:"#19be6b"},null,8,["checked"])])),_:1}),w(e,{class:"qrcode-section"},{default:v((()=>[b.value.qrcode?(g(),k(e,{key:0,class:"qrcode-wrapper"},{default:v((()=>[w(l,{class:"qrcode-image",src:b.value.qrcode,mode:"aspectFit",onClick:t[1]||(t[1]=a=>Q(b.value.qrcode))},null,8,["src"]),w(e,{class:"qrcode-actions"},{default:v((()=>[w(r,{class:"action-btn delete",onClick:t[2]||(t[2]=a=>D("wechat"))},{default:v((()=>[C("删除")])),_:1}),w(r,{class:"action-btn update",onClick:t[3]||(t[3]=a=>T("wechat"))},{default:v((()=>[C("更新")])),_:1})])),_:1})])),_:1})):(g(),k(e,{key:1,class:"upload-box",onClick:t[4]||(t[4]=a=>T("wechat"))},{default:v((()=>[w(s,{class:"upload-icon"},{default:v((()=>[C("+")])),_:1}),w(s,{class:"upload-text"},{default:v((()=>[C("上传微信支付二维码")])),_:1})])),_:1}))])),_:1})])),_:1}),w(e,{class:"payment-card"},{default:v((()=>[w(e,{class:"card-header"},{default:v((()=>[w(s,{class:"payment-title"},{default:v((()=>[C("支付宝")])),_:1}),w(c,{checked:1===F.value.status,onChange:t[5]||(t[5]=a=>P("alipay",a.detail.value)),color:"#1296db"},null,8,["checked"])])),_:1}),w(e,{class:"qrcode-section"},{default:v((()=>[F.value.qrcode?(g(),k(e,{key:0,class:"qrcode-wrapper"},{default:v((()=>[w(l,{class:"qrcode-image",src:F.value.qrcode,mode:"aspectFit",onClick:t[6]||(t[6]=a=>Q(F.value.qrcode))},null,8,["src"]),w(e,{class:"qrcode-actions"},{default:v((()=>[w(r,{class:"action-btn delete",onClick:t[7]||(t[7]=a=>D("alipay"))},{default:v((()=>[C("删除")])),_:1}),w(r,{class:"action-btn update",onClick:t[8]||(t[8]=a=>T("alipay"))},{default:v((()=>[C("更新")])),_:1})])),_:1})])),_:1})):(g(),k(e,{key:1,class:"upload-box",onClick:t[9]||(t[9]=a=>T("alipay"))},{default:v((()=>[w(s,{class:"upload-icon"},{default:v((()=>[C("+")])),_:1}),w(s,{class:"upload-text"},{default:v((()=>[C("上传支付宝二维码")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),w(e,{class:"tips-section"},{default:v((()=>[w(s,{class:"tips-title"},{default:v((()=>[C("使用说明")])),_:1}),w(e,{class:"tips-content"},{default:v((()=>[w(s,{class:"tip-item"},{default:v((()=>[C("1. 上传二维码后，用户可在充值页面扫码支付")])),_:1}),w(s,{class:"tip-item"},{default:v((()=>[C("2. 开关控制对应支付方式是否对用户可用")])),_:1}),w(s,{class:"tip-item"},{default:v((()=>[C("3. 建议上传清晰的二维码图片，尺寸建议为500x500像素")])),_:1}),w(s,{class:"tip-item"},{default:v((()=>[C("4. 用户支付后需上传支付凭证，由管理员审核后到账")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-3d83ae6e"]]);export{F as default};
