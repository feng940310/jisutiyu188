import{t as a,k as e,I as t,K as s,M as l,c,R as u}from"./uni.CnKTWU0K.js";import{Z as r}from"./index-C3v_m0JD.js";import{d,b as n,R as i,c as o,a6 as f,ad as v,aP as _,a7 as p,M as m,_ as y,aY as g,aX as k}from"./vendor.CqD9dFNX.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=h(d({__name:"weekly-card-config",setup(d){const h=n(20),b=n("0.00"),x=n(""),w=n(!1),F=n({activeUsers:0,totalRevenue:"0.00",thisWeekSales:0,expiringToday:0});i((()=>{const e=a();h.value=e.statusBarHeight||20,C(),S()}));const R=o((()=>{const a=parseFloat(x.value);return!w.value&&!isNaN(a)&&a>0&&a<=999.99&&a!==parseFloat(b.value)})),T=a=>{let e=a.detail.value;if(e.includes(".")){const a=e.split(".");a[1]&&a[1].length>2&&(e=a[0]+"."+a[1].substring(0,2),x.value=e)}},C=async()=>{try{const a=e("token"),{result:t}=await r.callFunction({name:"weeklyCard",data:{action:"getPrice",token:a}});t&&0===t.code?b.value=t.data.price.toFixed(2):(console.error("获取价格失败:",t),b.value="19.90")}catch(a){console.error("加载周卡价格失败:",a),b.value="19.90"}},S=async()=>{try{const a=e("token"),{result:t}=await r.callFunction({name:"weeklyCard",data:{action:"getStats",token:a}});t&&0===t.code&&(F.value={activeUsers:t.data.activeUsers,totalRevenue:t.data.totalRevenue.toFixed(2),thisWeekSales:t.data.thisWeekSales,expiringToday:t.data.expiringToday})}catch(a){console.error("加载统计信息失败:",a)}},U=async()=>{if(R.value)try{w.value=!0;const a=e("token"),t=parseFloat(x.value),{result:s}=await r.callFunction({name:"weeklyCard",data:{action:"setPrice",token:a,price:t}});s&&0===s.code?(b.value=t.toFixed(2),x.value="",c({title:"价格设置成功",icon:"success"})):c({title:(null==s?void 0:s.msg)||"设置失败",icon:"none"})}catch(a){console.error("保存价格失败:",a),c({title:"保存失败",icon:"none"})}finally{w.value=!1}},j=()=>{u()};return(a,e)=>{const c=t,u=s,r=l;return p(),f(c,{class:"weekly-card-config",style:_({paddingTop:h.value+"px"})},{default:v((()=>[m(c,{class:"status-bar",style:_({height:h.value+"px"})},null,8,["style"]),m(c,{class:"nav-bar",style:_({marginTop:h.value+"px"})},{default:v((()=>[m(c,{class:"nav-left",onClick:j},{default:v((()=>[m(c,{class:"back-arrow"})])),_:1}),m(c,{class:"nav-center"},{default:v((()=>[m(u,{class:"nav-title"},{default:v((()=>[y("周卡设置")])),_:1})])),_:1}),m(c,{class:"nav-right"})])),_:1},8,["style"]),m(c,{class:"content"},{default:v((()=>[m(c,{class:"current-price-card"},{default:v((()=>[m(c,{class:"card-header"},{default:v((()=>[m(u,{class:"card-title"},{default:v((()=>[y("💎 当前周卡价格")])),_:1})])),_:1}),m(c,{class:"current-price"},{default:v((()=>[m(u,{class:"price-value"},{default:v((()=>[y("¥"+g(b.value),1)])),_:1}),m(u,{class:"price-desc"},{default:v((()=>[y("7天会员权限")])),_:1})])),_:1})])),_:1}),m(c,{class:"price-setting-card"},{default:v((()=>[m(c,{class:"card-header"},{default:v((()=>[m(u,{class:"card-title"},{default:v((()=>[y("⚙️ 设置新价格")])),_:1})])),_:1}),m(c,{class:"price-input-section"},{default:v((()=>[m(c,{class:"input-label"},{default:v((()=>[y("周卡价格（元）")])),_:1}),m(c,{class:"input-wrapper"},{default:v((()=>[m(r,{type:"digit",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"请输入周卡价格",class:"price-input",onInput:T},null,8,["modelValue"]),m(u,{class:"currency"},{default:v((()=>[y("元")])),_:1})])),_:1}),m(c,{class:"input-tips"},{default:v((()=>[m(u,{class:"tip-text"},{default:v((()=>[y("• 支持小数点，如：9.90")])),_:1}),m(u,{class:"tip-text"},{default:v((()=>[y("• 价格范围：0.01 - 999.99 元")])),_:1})])),_:1})])),_:1}),m(c,{class:k(["save-button",{disabled:!R.value}]),onClick:U},{default:v((()=>[m(u,{class:"save-text"},{default:v((()=>[y(g(w.value?"保存中...":"保存设置"),1)])),_:1})])),_:1},8,["class"])])),_:1}),m(c,{class:"stats-card"},{default:v((()=>[m(c,{class:"card-header"},{default:v((()=>[m(u,{class:"card-title"},{default:v((()=>[y("📊 周卡统计")])),_:1})])),_:1}),m(c,{class:"stats-grid"},{default:v((()=>[m(c,{class:"stat-item"},{default:v((()=>[m(u,{class:"stat-number"},{default:v((()=>[y(g(F.value.activeUsers),1)])),_:1}),m(u,{class:"stat-label"},{default:v((()=>[y("活跃周卡用户")])),_:1})])),_:1}),m(c,{class:"stat-item"},{default:v((()=>[m(u,{class:"stat-number"},{default:v((()=>[y(g(F.value.totalRevenue),1)])),_:1}),m(u,{class:"stat-label"},{default:v((()=>[y("总收入（元）")])),_:1})])),_:1}),m(c,{class:"stat-item"},{default:v((()=>[m(u,{class:"stat-number"},{default:v((()=>[y(g(F.value.thisWeekSales),1)])),_:1}),m(u,{class:"stat-label"},{default:v((()=>[y("本周销量")])),_:1})])),_:1}),m(c,{class:"stat-item"},{default:v((()=>[m(u,{class:"stat-number"},{default:v((()=>[y(g(F.value.expiringToday),1)])),_:1}),m(u,{class:"stat-label"},{default:v((()=>[y("今日到期")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])}}}),[["__scopeId","data-v-07178784"]]);export{b as default};
