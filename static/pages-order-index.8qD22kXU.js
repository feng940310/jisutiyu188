import{c as a,t,I as e,S as s,K as o,J as l,L as r,l as n,E as c,d as i,D as u}from"./uni.CnKTWU0K.js";import{Z as d}from"./index-C3v_m0JD.js";import{d as p,b as m,R as g,a6 as f,ad as _,a7 as v,M as h,aP as y,aW as x,_ as k,aN as b,az as C,ak as w,aY as $,ai as j}from"./vendor.CqD9dFNX.js";import{C as D}from"./CustomTabBar.D3O6WTuX.js";import{g as S}from"./loginHelper.B8-BL7my.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=A(p({__name:"index",setup(p){const A=m(0),F=m(44);m(20);const P=m([]),R=m(!1),T=a=>{switch(a){case"active":return"进行中";case"upcoming":return"未开始";case"ended":return"已结束";default:return"未知"}},B=(a,t)=>{if(!a)return"未设置";const e=a=>{if(!a)return"";const t=new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`};return a&&t?`${e(a)} ~ ${e(t)}`:e(a)},H=()=>{u({url:"/pages/index/index"})};return g((()=>{(()=>{const a=t();A.value=a.statusBarHeight||0,F.value=44})(),(async()=>{try{R.value=!0;const t=S();if(!t)return void a({title:"请先登录",icon:"none"});console.log("开始获取用户已购买聊天室");const{result:e}=await d.callFunction({name:"user",data:{action:"getPurchasedRooms",token:t}});if(console.log("获取到的数据:",e),!e||0!==e.code||!e.data)return a({title:(null==e?void 0:e.message)||"获取数据失败",icon:"none"}),void(P.value=[]);P.value=e.data.map((a=>(a.avatarUrl&&!a.avatar&&(a.avatar=a.avatarUrl),a))),P.value.sort(((a,t)=>{const e={active:0,upcoming:1,ended:2};return e[a.type||"upcoming"]-e[t.type||"upcoming"]}))}catch(t){console.error("获取聊天室列表失败:",t),a({title:"获取数据失败",icon:"none"}),P.value=[]}finally{R.value=!1}})()})),(a,t)=>{const u=e,d=o,p=l,m=r,g=s;return v(),f(u,{class:"page-container"},{default:_((()=>[h(u,{class:"page-background"}),h(g,{"scroll-y":"true",class:"scroll-container",style:y({paddingTop:A.value+F.value+10+"px",paddingBottom:"150rpx"})},{default:_((()=>[h(u,{class:"content"},{default:_((()=>[h(u,{class:"header"},{default:_((()=>[h(d,{class:"title"},{default:_((()=>[k("已购订单/最新发布")])),_:1})])),_:1}),h(u,{class:"chat-room-list"},{default:_((()=>[(v(!0),b(C,null,w(P.value,((a,t)=>(v(),f(u,{class:"chat-room-item",key:t,onClick:t=>(a=>{console.log("进入聊天室",`/packageA/pages/chat/index?id=${a.id}&mode=history`,a),n("sourcePageForChatRoom","order"),"ended"!==a.type?"upcoming"!==a.type?c({url:`/packageA/pages/chat/ChatRoomDetailsPage?id=${a.room_id}&mode=history`}):i({title:"提示",content:"等待团购中，快召唤他",showCancel:!1,confirmText:"知道了"}):c({url:`/packageA/pages/chat/index?id=${a.room_id}&mode=history`})})(a)},{default:_((()=>[h(u,{class:"avatar-container"},{default:_((()=>[h(p,{class:"avatar",src:a.avatar,mode:"aspectFill"},null,8,["src"]),a.isNew?(v(),f(u,{key:0,class:"status-badge"},{default:_((()=>[k("新")])),_:1})):x("",!0)])),_:2},1024),h(u,{class:"room-status"},{default:_((()=>[h(u,{class:"status-tag"},{default:_((()=>[k($(T(a.type||"upcoming")),1)])),_:2},1024)])),_:2},1024),h(u,{class:"info-container"},{default:_((()=>[h(u,{class:"top-row"},{default:_((()=>[h(d,{class:"room-name"},{default:_((()=>[k($(a.title),1)])),_:2},1024),h(u,{class:"time-container"},{default:_((()=>[h(u,{class:"room-status"},{default:_((()=>[h(u,{class:"status-tag"},{default:_((()=>[k($(T(a.type||"upcoming")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(u,{class:"bottom-row"},{default:_((()=>[h(d,{class:"sub-title text-ellipsis"},{default:_((()=>[k($(a.subtitle),1)])),_:2},1024),h(u,{class:"action-area"},{default:_((()=>[h(m,{class:"cancel-btn",onClick:j((t=>(a=>{"upcoming"!==a.type?c({url:`/packageA/pages/chat/index?id=${a.room_id}&mode=history`}):i({title:"提示",content:"等待团购中，快召唤他",showCancel:!1,confirmText:"知道了"})})(a)),["stop"])},{default:_((()=>[k("查看记录")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),h(u,{class:"bottom-row"},{default:_((()=>[h(d,{class:"room-id"},{default:_((()=>[k($(B(a.startDate,a.endDate)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),0===P.value.length?(v(),f(u,{key:0,class:"empty-state"},{default:_((()=>[h(d,{class:"empty-text"},{default:_((()=>[k("暂无订阅的聊天室")])),_:1}),h(m,{class:"explore-btn",onClick:H},{default:_((()=>[k("发现聊天室")])),_:1})])),_:1})):x("",!0),h(u,{style:{height:"120rpx"}})])),_:1})])),_:1},8,["style"]),h(D)])),_:1})}}}),[["__scopeId","data-v-a10a861b"]]);export{F as default};
