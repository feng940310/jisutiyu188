import{t as a,k as e,c as t,b as s,h as l,I as n,K as o,d as u,R as r}from"./uni.CnKTWU0K.js";import{Z as c}from"./index-C3v_m0JD.js";import{d as i,b as d,r as f,R as v,a6 as _,ad as m,a7 as p,M as g,aP as h,_ as y,aY as k,aN as w,az as b,ak as x,aX as S}from"./vendor.CqD9dFNX.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=$(i({__name:"user-management",setup(i){const $=d(0),I=d(44),C=d({}),H=d(0),T=d([]),j=f({});v((()=>{var e;try{const t=a();$.value=(null==(e=t.safeAreaInsets)?void 0:e.top)||t.statusBarHeight||0,"ios"===t.platform?I.value=44:"android"===t.platform?I.value=48:I.value=44,H.value=$.value+I.value,console.log("导航栏尺寸信息:",{safeAreaTop:$.value,navBarHeight:I.value,totalNavHeight:H.value,menuButtonInfo:C.value})}catch(t){console.error("获取系统信息失败:",t),$.value=20,I.value=44,H.value=64}P()}));const P=async()=>{try{const a=e("token");if(!a)return void t({title:"请先登录",icon:"none"});s({title:"加载中...",mask:!0});const{result:l}=await c.callFunction({name:"admin",data:{action:"getAllUsers",token:a}});console.log("获取用户列表结果:",l),l&&0===l.code?(T.value=l.data||[],0===T.value.length&&t({title:"暂无用户数据",icon:"none"})):t({title:(null==l?void 0:l.message)||"获取用户列表失败",icon:"none",duration:2e3})}catch(a){console.error("获取用户列表失败:",a),t({title:"网络请求失败，请重试",icon:"none",duration:2e3})}finally{l()}},A=()=>{P()},B=a=>{if(!a)return"未知";const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},F=()=>{r()};return(a,r)=>{const i=n,d=o;return p(),_(i,{class:"user-management"},{default:m((()=>[g(i,{class:"custom-nav-bar",style:h({paddingTop:$.value+"px"})},{default:m((()=>[g(i,{class:"nav-content",style:h({height:I.value+"px"})},{default:m((()=>[g(i,{class:"nav-left",onClick:F},{default:m((()=>[g(i,{class:"back-icon"},{default:m((()=>[y("←")])),_:1})])),_:1}),g(i,{class:"nav-center"},{default:m((()=>[g(d,{class:"nav-title"},{default:m((()=>[y("用户管理")])),_:1})])),_:1}),g(i,{class:"nav-right"})])),_:1},8,["style"])])),_:1},8,["style"]),g(i,{class:"content",style:h({paddingTop:H.value+"px"})},{default:m((()=>[g(i,{class:"user-list-section"},{default:m((()=>[g(i,{class:"list-header"},{default:m((()=>[g(i,{class:"user-count"},{default:m((()=>[g(d,null,{default:m((()=>[y("共 "+k(T.value.length)+" 个用户",1)])),_:1})])),_:1}),g(i,{class:"refresh-btn",onClick:A},{default:m((()=>[g(d,null,{default:m((()=>[y("刷新")])),_:1})])),_:1})])),_:1}),g(i,{class:"user-list",style:h({maxHeight:`calc(100vh - ${H.value+200}px)`})},{default:m((()=>[(p(!0),w(b,null,x(T.value,((a,n)=>(p(),_(i,{key:a.id,class:"user-item"},{default:m((()=>[g(i,{class:"user-info"},{default:m((()=>[g(i,{class:"user-row"},{default:m((()=>[g(d,{class:"label"},{default:m((()=>[y("用户名:")])),_:1}),g(d,{class:"value"},{default:m((()=>[y(k(a.username),1)])),_:2},1024)])),_:2},1024),g(i,{class:"user-row"},{default:m((()=>[g(d,{class:"label"},{default:m((()=>[y("手机号:")])),_:1}),g(d,{class:"value"},{default:m((()=>[y(k(a.phone),1)])),_:2},1024)])),_:2},1024),g(i,{class:"user-row"},{default:m((()=>[g(d,{class:"label"},{default:m((()=>[y("密码:")])),_:1}),g(d,{class:"value password-encrypted"},{default:m((()=>[y("已加密")])),_:1})])),_:1}),g(i,{class:"user-row"},{default:m((()=>[g(d,{class:"label"},{default:m((()=>[y("注册时间:")])),_:1}),g(d,{class:"value"},{default:m((()=>[y(k(B(a.create_time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(i,{class:"user-actions"},{default:m((()=>[g(i,{class:S(["reset-btn",{disabled:j[a.id]}]),onClick:n=>(async a=>{if(!j[a.id])try{const l=`user${a.id.toString().slice(-3)}888`;if(!(await new Promise((e=>{u({title:"确认重置密码",content:`确定要重置用户 ${a.username} 的密码吗？\n\n新密码: ${l}\n\n此操作不可撤销，请谨慎操作！`,confirmText:"确认重置",cancelText:"取消",confirmColor:"#ff4d4f",success:a=>{e(a.confirm)},fail:()=>{e(!1)}})}))))return;j[a.id]=!0;const n=e("token");if(!n)return t({title:"请先登录",icon:"none"}),void(j[a.id]=!1);s({title:"重置中...",mask:!0});const{result:o}=await c.callFunction({name:"admin",data:{action:"resetUserPassword",token:n,data:{userId:a.id,newPassword:l}}});if(console.log("密码重置结果:",o),o&&0===o.code){const e=T.value.findIndex((e=>e.id===a.id));-1!==e&&(T.value[e].password=l),t({title:"密码重置成功",icon:"success",duration:1500})}else t({title:(null==o?void 0:o.message)||"密码重置失败",icon:"none",duration:2e3})}catch(n){console.error("密码重置失败:",n),t({title:"网络请求失败，请重试",icon:"none",duration:2e3})}finally{j[a.id]=!1,l()}})(a)},{default:m((()=>[j[a.id]?(p(),_(d,{key:0},{default:m((()=>[y("重置中...")])),_:1})):(p(),_(d,{key:1},{default:m((()=>[y("重置密码")])),_:1}))])),_:2},1032,["onClick","class"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1},8,["style"])])),_:1})}}}),[["__scopeId","data-v-1da1a71f"]]);export{I as default};
